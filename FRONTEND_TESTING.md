# Guide de Test Frontend - Staffing ESN

Guide pour tester l'interface utilisateur React du projet Staffing ESN.

---

## üöÄ D√©marrage Rapide

### 1. Pr√©requis

Assurez-vous que l'API backend est d√©marr√©e :

```bash
# Dans un terminal
cd api
npm run dev
# API accessible sur http://localhost:8787
```

### 2. D√©marrer le Frontend

```bash
# Dans un autre terminal
cd frontend
npm run dev
# Frontend accessible sur http://localhost:5173
```

### 3. Ouvrir dans le navigateur

Ouvrez votre navigateur sur : **http://localhost:5173**

---

## üñ•Ô∏è Interface Actuelle

### Page d'Accueil (Demo)

L'application affiche actuellement une page de d√©monstration qui v√©rifie la connexion avec l'API backend.

**Ce que vous devriez voir :**

```
üè¢ Staffing ESN
CHANTIER_00 - Setup Infrastructure

‚úÖ Status

Frontend
‚úÖ running
React 18 + Vite + Tailwind CSS

API
‚úÖ connected
Staffing ESN API - Production Ready

‚úÖ Infrastructure fonctionnelle !
Version API: 0.11.1

Pr√™t pour CHANTIER_01 : Auth JWT + RBAC
```

**Si la connexion API √©choue :**
- Statut API : ‚ùå disconnected
- V√©rifier que l'API tourne sur http://localhost:8787
- V√©rifier le fichier `frontend/.env` contient `VITE_API_URL=http://localhost:8787`

---

## üìÅ Structure du Frontend

```
frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx              # Composant principal
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx             # Point d'entr√©e
‚îÇ   ‚îú‚îÄ‚îÄ components/          # Composants r√©utilisables (√† impl√©menter)
‚îÇ   ‚îú‚îÄ‚îÄ pages/               # Pages de l'application (√† impl√©menter)
‚îÇ   ‚îú‚îÄ‚îÄ services/            # Services API (√† impl√©menter)
‚îÇ   ‚îú‚îÄ‚îÄ stores/              # State management Zustand (√† impl√©menter)
‚îÇ   ‚îú‚îÄ‚îÄ hooks/               # Custom hooks React (√† impl√©menter)
‚îÇ   ‚îú‚îÄ‚îÄ types/               # Types TypeScript (√† impl√©menter)
‚îÇ   ‚îú‚îÄ‚îÄ utils/               # Utilitaires (√† impl√©menter)
‚îÇ   ‚îî‚îÄ‚îÄ styles/
‚îÇ       ‚îî‚îÄ‚îÄ index.css        # Styles globaux Tailwind
‚îú‚îÄ‚îÄ .env                     # Variables d'environnement
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ vite.config.ts
‚îú‚îÄ‚îÄ tailwind.config.js
‚îî‚îÄ‚îÄ tsconfig.json
```

---

## üîß Configuration

### Variables d'Environnement

Fichier `frontend/.env` :

```env
# Development environment
VITE_API_URL=http://localhost:8787
```

**Note** : Toutes les variables d'environnement pour Vite doivent commencer par `VITE_`

### Acc√®s dans le code

```typescript
const apiUrl = import.meta.env.VITE_API_URL;
```

---

## üß™ Tests

### Tests Unitaires (Vitest)

```bash
# Lancer les tests une fois
npm run test

# Mode watch (relance automatique)
npm run test:watch

# Interface UI pour les tests
npm run test:ui

# Coverage
npm run test:coverage
```

### Tests E2E (Playwright)

```bash
# Lancer les tests E2E
npm run test:e2e

# Avec interface UI
npm run test:e2e:ui

# Mode headed (voir le navigateur)
npm run test:e2e:headed
```

### Tous les tests

```bash
npm run test:all
```

---

## üõ†Ô∏è Outils de D√©veloppement

### TypeScript Type Check

```bash
npm run typecheck
```

### Build de Production

```bash
npm run build
```

Le build g√©n√®re les fichiers dans `frontend/dist/`

### Preview du Build

```bash
npm run preview
```

Teste le build de production localement sur http://localhost:4173

---

## üé® Stack Technique

### Frontend Framework
- **React 18** - Library UI
- **TypeScript** - Type safety
- **Vite** - Build tool ultra-rapide
- **Tailwind CSS** - Utility-first CSS

### State Management
- **Zustand** - State management l√©ger
- **TanStack Query (React Query)** - Data fetching et cache

### Routing
- **React Router v6** - Navigation SPA

### Testing
- **Vitest** - Tests unitaires (compatible Vite)
- **Playwright** - Tests E2E
- **Testing Library** - Tests composants React

### PWA
- **Vite PWA Plugin** - Progressive Web App
- **Workbox** - Service workers

### Utilitaires
- **date-fns** - Manipulation de dates

---

## üìã Fonctionnalit√©s √† Impl√©menter

Le frontend est actuellement en phase CHANTIER_00 (infrastructure). Les fonctionnalit√©s suivantes sont √† d√©velopper :

### CHANTIER_01 : Authentification
- [ ] Page de login
- [ ] Page de register
- [ ] Gestion du token JWT
- [ ] Route prot√©g√©e avec AuthGuard
- [ ] Store Zustand pour l'auth

### CHANTIER_02 : Dashboard
- [ ] Dashboard consultant
- [ ] Dashboard chef de projet
- [ ] Dashboard administrateur
- [ ] Dashboard directeur (avec CJR)

### CHANTIER_03 : Gestion Consultants
- [ ] Liste des consultants
- [ ] Formulaire cr√©ation consultant
- [ ] √âdition consultant
- [ ] D√©tails consultant

### CHANTIER_04 : Gestion Projets
- [ ] Liste des projets
- [ ] Formulaire cr√©ation projet
- [ ] √âdition projet
- [ ] D√©tails projet avec interventions

### CHANTIER_05 : Timesheets
- [ ] Calendrier de saisie
- [ ] Formulaire timesheet
- [ ] Vue hebdomadaire
- [ ] Vue mensuelle
- [ ] Statuts (brouillon, soumis, valid√©, rejet√©)

### CHANTIER_06 : Validations
- [ ] Liste des validations en attente
- [ ] Actions bulk (tout valider/tout rejeter)
- [ ] Historique validations

### CHANTIER_07 : Marges & Analytics
- [ ] Graphiques de marges (CJN/CJR)
- [ ] KPIs par projet
- [ ] Taux d'utilisation consultants
- [ ] Charts avec Recharts ou Chart.js

### CHANTIER_08 : Chat IA
- [ ] Interface chat avec Gemini
- [ ] Historique conversations
- [ ] Suggestions d'actions
- [ ] NLU pour commandes vocales

### CHANTIER_09 : Audit & Logs
- [ ] Vue des logs d'acc√®s CJR
- [ ] Filtres par utilisateur/date
- [ ] Export CSV

### CHANTIER_10 : PWA & Offline
- [ ] Service worker
- [ ] Cache API
- [ ] Mode offline
- [ ] Notifications push

---

## üéØ Exemples de Composants √† Cr√©er

### Service API (`src/services/api.ts`)

```typescript
const API_URL = import.meta.env.VITE_API_URL;

export const api = {
  // Auth
  login: async (email: string, password: string) => {
    const res = await fetch(`${API_URL}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password }),
    });
    return res.json();
  },

  // Protected requests
  fetchWithAuth: async (endpoint: string, options: RequestInit = {}) => {
    const token = localStorage.getItem('token');
    const res = await fetch(`${API_URL}${endpoint}`, {
      ...options,
      headers: {
        ...options.headers,
        'Authorization': `Bearer ${token}`,
      },
    });
    return res.json();
  },
};
```

### Auth Store (`src/stores/authStore.ts`)

```typescript
import { create } from 'zustand';

interface AuthState {
  token: string | null;
  user: any | null;
  isAuthenticated: boolean;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
}

export const useAuthStore = create<AuthState>((set) => ({
  token: localStorage.getItem('token'),
  user: null,
  isAuthenticated: !!localStorage.getItem('token'),

  login: async (email, password) => {
    const response = await api.login(email, password);
    if (response.success) {
      localStorage.setItem('token', response.data.token);
      set({
        token: response.data.token,
        user: response.data.user,
        isAuthenticated: true
      });
    }
  },

  logout: () => {
    localStorage.removeItem('token');
    set({ token: null, user: null, isAuthenticated: false });
  },
}));
```

### Page Login (`src/pages/Login.tsx`)

```typescript
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuthStore } from '../stores/authStore';

export default function Login() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const login = useAuthStore(state => state.login);
  const navigate = useNavigate();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      await login(email, password);
      navigate('/dashboard');
    } catch (error) {
      console.error('Login failed:', error);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <form onSubmit={handleSubmit} className="bg-white p-8 rounded-lg shadow-md">
        <h1 className="text-2xl font-bold mb-6">Connexion</h1>

        <input
          type="email"
          placeholder="Email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          className="w-full p-2 border rounded mb-4"
        />

        <input
          type="password"
          placeholder="Mot de passe"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          className="w-full p-2 border rounded mb-4"
        />

        <button
          type="submit"
          className="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700"
        >
          Se connecter
        </button>
      </form>
    </div>
  );
}
```

---

## üîç Debugging

### React DevTools

Installer l'extension React DevTools pour Chrome/Firefox :
- https://react.dev/learn/react-developer-tools

### Vite DevTools

Les erreurs de build apparaissent directement dans le terminal et dans le navigateur avec overlay.

### Console du Navigateur

Ouvrir les DevTools (F12) pour voir :
- Logs console
- Network requests
- React component tree

### Inspecter les Requ√™tes API

Dans l'onglet Network des DevTools :
- Filtrer par "Fetch/XHR"
- V√©rifier les headers (Authorization: Bearer ...)
- V√©rifier les payloads
- V√©rifier les status codes (200, 401, 500...)

---

## üö® Troubleshooting

### Port 5173 d√©j√† utilis√©

```bash
# Trouver et tuer le processus
lsof -ti:5173 | xargs kill -9
```

### Erreur CORS

Si vous voyez des erreurs CORS dans la console :
1. V√©rifier que l'API autorise `http://localhost:5173` dans ses origins CORS
2. Fichier `api/src/index.ts` ligne ~20 :
```typescript
app.use('*', cors({
  origin: ['http://localhost:5173', 'http://localhost:3000'],
  credentials: true,
}));
```

### API non accessible

V√©rifier :
1. L'API est d√©marr√©e (`npm run dev` dans `api/`)
2. L'URL dans `.env` est correcte : `VITE_API_URL=http://localhost:8787`
3. Tester l'API directement : `curl http://localhost:8787/health`

### Hot Reload ne fonctionne pas

```bash
# Red√©marrer Vite
# Ctrl+C puis
npm run dev
```

### Build √©choue

```bash
# V√©rifier les erreurs TypeScript
npm run typecheck

# Nettoyer et rebuild
rm -rf dist node_modules
npm install
npm run build
```

---

## üìö Ressources Utiles

### Documentation
- **React** : https://react.dev
- **Vite** : https://vitejs.dev
- **Tailwind CSS** : https://tailwindcss.com
- **React Router** : https://reactrouter.com
- **Zustand** : https://zustand-demo.pmnd.rs
- **TanStack Query** : https://tanstack.com/query
- **Vitest** : https://vitest.dev
- **Playwright** : https://playwright.dev

### Tailwind UI Components
- **Headless UI** : https://headlessui.com (accessible components)
- **Heroicons** : https://heroicons.com (ic√¥nes SVG)
- **Tailwind UI** : https://tailwindui.com (payant mais excellent)

### Charts & Visualizations
- **Recharts** : https://recharts.org
- **Chart.js** : https://www.chartjs.org
- **Apache ECharts** : https://echarts.apache.org

---

## ‚úÖ Checklist de Test Frontend

Avant de consid√©rer une fonctionnalit√© compl√®te :

- [ ] Page s'affiche correctement
- [ ] Responsive design (mobile, tablet, desktop)
- [ ] Loading states (spinners, skeletons)
- [ ] Error states (messages d'erreur clairs)
- [ ] Success feedback (toasts, messages)
- [ ] Validation formulaires
- [ ] TypeScript sans erreur (`npm run typecheck`)
- [ ] Tests unitaires passent (`npm run test`)
- [ ] Tests E2E passent (`npm run test:e2e`)
- [ ] Build de production r√©ussit (`npm run build`)
- [ ] Pas d'erreurs console
- [ ] Accessibilit√© (ARIA, keyboard navigation)
- [ ] Performance (Lighthouse score > 90)

---

## üé® Design System Recommand√©

### Couleurs

```css
/* Palette Staffing ESN */
primary: #3B82F6 (blue-500)
secondary: #6366F1 (indigo-500)
success: #10B981 (green-500)
warning: #F59E0B (amber-500)
danger: #EF4444 (red-500)
gray: #6B7280 (gray-500)
```

### Spacing

Utiliser les classes Tailwind standard :
- `p-4`, `m-4` (1rem = 16px)
- `space-y-4`, `gap-4`

### Typography

```css
h1: text-4xl font-bold
h2: text-3xl font-semibold
h3: text-2xl font-semibold
body: text-base
small: text-sm
```

---

## üöÄ Prochaines √âtapes

1. **Impl√©menter l'authentification**
   - Pages login/register
   - Auth store avec Zustand
   - Protected routes

2. **Cr√©er les composants de base**
   - Button, Input, Card, Modal
   - Layout avec Sidebar + Navbar
   - Loader, Toast notifications

3. **D√©velopper le Dashboard**
   - Role-based dashboards
   - KPI cards
   - Charts avec Recharts

4. **Int√©grer l'API**
   - Service API avec fetch
   - React Query pour le cache
   - Error handling global

---

**Frontend pr√™t pour le d√©veloppement !** ‚úÖ

Pour acc√©der : **http://localhost:5173**

API connect√©e sur : **http://localhost:8787**
